# ğŸš€ ImTicket: ì¸í”„ë¼ ë° ì•„í‚¤í…ì²˜ ê³ ë„í™” ì „ëµ

## 1. ğŸ¯ ì „ëµì  ë°©í–¥ì„±: "Why not Kafka?"ì— ëŒ€í•œ ë‹µë³€
ì´ í”„ë¡œì íŠ¸ëŠ” **'ê¸°ìˆ ì„ ìœ„í•œ ê¸°ìˆ  ë„ì…'**ì´ ì•„ë‹Œ, **'ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ê³¼ ì œì•½ ì¡°ê±´ì— ë§ì¶˜ ìµœì í™”ëœ ì•„í‚¤í…ì²˜'**ë¥¼ ì§€í–¥í•©ë‹ˆë‹¤.

### ğŸ›¡ í•µì‹¬ ë…¼ë¦¬ (Defense Logic)
*   **ë¬¸ì œ ì˜ì‹**: KafkaëŠ” ê°•ë ¥í•˜ì§€ë§Œ, í˜„ì¬ í”„ë¡œì íŠ¸ ê·œëª¨(Monolith, ë‹¨ì¼ ê°œë°œì) ë° íŠ¸ë˜í”½ íŠ¹ì„±ìƒ ìš´ì˜ ì˜¤ë²„í—¤ë“œê°€ ê³¼ë„í•©ë‹ˆë‹¤. ì´ëŠ” ì „í˜•ì ì¸ **Over-Engineering** ì‚¬ë¡€ê°€ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
*   **í•´ê²°ì±…**: **Redis**ë¥¼ ë‹¨ìˆœ ìºì‹œ ìš©ë„ê°€ ì•„ë‹Œ, **In-Memory Message Broker**ë¡œ í™•ì¥í•˜ì—¬ í™œìš©í•©ë‹ˆë‹¤.
*   **ì „ë¬¸ì„± ì–´í•„ í¬ì¸íŠ¸**:
    *   "ë‹¨ìˆœíˆ ëª°ë¼ì„œ ì•ˆ ì“´ ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤."
    *   "Kafkaì˜ ë‚´êµ¬ì„±(Durability)ê³¼ í™•ì¥ì„±(Scalability)ì´ í•„ìš”í•œ ì§€ì ê³¼, Redisì˜ ê²½ëŸ‰ì„±(Lightweight)ê³¼ ì†ë„(Speed)ê°€ í•„ìš”í•œ ì§€ì ì„ ëª…í™•íˆ êµ¬ë¶„í–ˆìŠµë‹ˆë‹¤."
    *   "í˜„ì¬ì˜ ëª¨ë†€ë¦¬ì‹ êµ¬ì¡°ì™€ ì œí•œëœ ë¦¬ì†ŒìŠ¤ ë‚´ì—ì„œ **ê²°í•©ë„(Coupling)ë¥¼ ë‚®ì¶”ê³  ë°ì´í„° ìœ ì‹¤ì„ ë°©ì§€**í•˜ê¸° ìœ„í•´ **Redis Streams**ë¥¼ ì„ íƒí–ˆìŠµë‹ˆë‹¤."

---

## 2. ğŸ— ì•„í‚¤í…ì²˜ ì—…ê·¸ë ˆì´ë“œ: From @Async to Redis Streams

í˜„ì¬ `VenueHallService`ì™€ `SeatService`ì—ì„œ ì‚¬ìš© ì¤‘ì¸ `@Async`ëŠ” í¸ë¦¬í•˜ì§€ë§Œ, **ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ ì‹œ ì‘ì—… ìœ ì‹¤ ìœ„í—˜**ì´ ìˆìŠµë‹ˆë‹¤. ì´ë¥¼ Redis Streamsë¡œ ëŒ€ì²´í•˜ì—¬ ì•ˆì •ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.

### ğŸ”„ ë³€ê²½ ì „ (Current)
*   **Flow**: Client Request -> Controller -> Service(`@Async` Method) -> DB Save
*   **Risk**: ëŒ€ëŸ‰ì˜ ì¢Œì„ ìƒì„± ì¤‘ ì„œë²„ê°€ ë°°í¬ë˜ê±°ë‚˜ ë¹„ì •ìƒ ì¢…ë£Œë˜ë©´, ì‘ì—…ì´ ì¤‘ê°„ì— ëŠê¸°ê³  ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. (ë°ì´í„° ì •í•©ì„± ê¹¨ì§)

### âœ… ë³€ê²½ í›„ (Target) - Redis Streams ë„ì…
*   **Flow**:
    1.  **Producer**: Client Request -> Controller -> **Redis Stream (Topic: `seat-creation`)** ì— ì´ë²¤íŠ¸ ë°œí–‰ (ACK ë°˜í™˜)
    2.  **Broker**: Redisê°€ ë©”ì‹œì§€ë¥¼ ì˜êµ¬ ì €ì¥ (AOF/RDB ì„¤ì •ìœ¼ë¡œ ë‚´êµ¬ì„± ë³´ì¥ ê°€ëŠ¥)
    3.  **Consumer**: `StreamListener` -> Service -> DB Save
*   **Benefit**:
    *   **ì‹ ë¢°ì„±**: ì„œë²„ê°€ ì£½ì–´ë„ Redisì— ë©”ì‹œì§€ê°€ ë‚¨ì•„ìˆì–´, ì¬ê¸°ë™ ì‹œ **Consumer Group**ì´ ë§ˆì§€ë§‰ ì§€ì ë¶€í„° ë‹¤ì‹œ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    *   **í™•ì¥ì„±**: ì¶”í›„ ì¢Œì„ ìƒì„± ì„œë²„ë¥¼ ìŠ¤ì¼€ì¼ ì•„ì›ƒí•˜ë”ë¼ë„ ì¤‘ë³µ ì²˜ë¦¬ ì—†ì´ ë³‘ë ¬ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### ğŸ›  êµ¬í˜„ ê³„íš (Implementation)
1.  **Redis Config**: `Lettuce` ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ Redis Template ë° StreamListenerContainer ì„¤ì •.
2.  **Producer**: `VenueHallService`, `SeatService`ì˜ ë¡œì§ í˜¸ì¶œ ëŒ€ì‹  `SeatCreationEvent` ê°ì²´ë¥¼ ë°œí–‰í•˜ëŠ” ì½”ë“œë¡œ ëŒ€ì²´.
3.  **Consumer**: `SeatCreationEventListener`ë¥¼ êµ¬í˜„í•˜ì—¬ ì‹¤ì œ DB ì‘ì—… ë¡œì§(`processSeats` ë“±) ì´ê´€.
4.  **Error Handling**: ì²˜ë¦¬ ì‹¤íŒ¨ ì‹œ Dead Letter Queue ì—­í• ì„ í•  ë³„ë„ Stream ë˜ëŠ” Retry ë¡œì§ êµ¬í˜„.

---

## 3. âš¡ Redis Caching: "ì„±ëŠ¥ ìµœì í™”ì˜ ê½ƒ" (ê°€ì„±ë¹„ ì „ëµ)

ë‹¨ìˆœí•œ Key-Value ì €ì¥ì„ ë„˜ì–´, **ì „ëµì  ìºì‹± íŒ¨í„´**ì„ ì ìš©í•˜ì—¬ ì‹¤ì§ˆì ì¸ ì„±ëŠ¥ ê°œì„ ì„ ì¦ëª…í•©ë‹ˆë‹¤.

### ğŸ¯ ì „ëµ ì„ íƒ: Look-aside (Lazy Loading) Pattern
*   **Target**: **ê³µì—° ìƒì„¸ ì •ë³´(Performance Info)** ë“± ì¡°íšŒ ë¹ˆë„ëŠ” ë†’ìœ¼ë‚˜ ë³€ê²½ ë¹ˆë„ëŠ” ë‚®ì€ ë°ì´í„°.
*   **Why Look-aside?**:
    *   **ì•ˆì „ì„±**: Redisê°€ ë‹¤ìš´ë˜ë”ë¼ë„ DBì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆì–´ ì„œë¹„ìŠ¤ ì¥ì• (SPOF)ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
    *   **íš¨ìœ¨ì„±**: ì‹¤ì œ ìš”ì²­ì´ ìˆëŠ” ë°ì´í„°ë§Œ ìºì‹±ë˜ë¯€ë¡œ ë¶ˆí•„ìš”í•œ ë©”ëª¨ë¦¬ ë‚­ë¹„ë¥¼ ë§‰ìŠµë‹ˆë‹¤.

### ğŸ”„ Flow
1.  **Client Request**: ê³µì—° ì •ë³´ ìš”ì²­.
2.  **Cache Check**: Redisì— ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸ (Cache Hit).
3.  **DB Fallback**: ì—†ìœ¼ë©´(Cache Miss) DB ì¡°íšŒ í›„ Redisì— ì €ì¥(TTL ì„¤ì • í•„ìˆ˜).
4.  **Return**: ê²°ê³¼ ë°˜í™˜.

### ğŸ“ˆ ì¦ëª… í¬ì¸íŠ¸ (For Portfolio)
*   **"DB ë¶€í•˜ ê°ì†Œ ì¦ëª…"**:
    *   k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ì‹œ, ìºì‹œ ì ìš© ì „í›„ì˜ **DB CPU Usage** ë° **Query Throughput** ë¹„êµ.
    *   ë©˜íŠ¸ ì˜ˆì‹œ: *"ë©”ì¸ í˜ì´ì§€ ì ‘ì† ì‹œ ë°œìƒí•˜ëŠ” ê³µì—° ëª©ë¡ ì¡°íšŒ ì¿¼ë¦¬ì— Look-aside ìºì‹±ì„ ì ìš©í•˜ì—¬, ë™ì‹œ ì ‘ì†ì 1,000ëª… ìƒí™©ì—ì„œ DB CPU ë¶€í•˜ë¥¼ 80% -> 20%ë¡œ ê°ì†Œì‹œì¼°ìŠµë‹ˆë‹¤."*

---

## 4. â™¾ï¸ DevOps: "ìš´ì˜ í™˜ê²½ì„ ì´í•´í•˜ëŠ” ê°œë°œì" (Docker + CI/CD)

ë‹¨ìˆœí•œ ì½”ë“œ ì‹¤í–‰ì´ ì•„ë‹Œ, **'ì„œë¹„ìŠ¤ ìš´ì˜'** ê´€ì ì˜ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ì™„ì„±í•©ë‹ˆë‹¤.

### ğŸ“¦ Docker & Compose
*   **ëª©í‘œ**: "Local == Production". ê°œë°œ í™˜ê²½ê³¼ ë°°í¬ í™˜ê²½ì˜ ì°¨ì´ë¡œ ì¸í•œ ë²„ê·¸(Works on my machine) ì›ì²œ ì°¨ë‹¨.
*   **Action**:
    *   `docker-compose.yml`: Spring Boot + Redis + (Optional: MySQL) í†µí•© êµ¬ì„±.
    *   Application Health Check ì„¤ì •.

### ğŸš€ CI/CD Pipeline (Github Actions)
*   **Flow**:
    1.  **Push**: Main ë¸Œëœì¹˜ í‘¸ì‹œ
    2.  **Build**: Gradle Build (Test í¬í•¨)
    3.  **Image Build**: Docker Image ë¹Œë“œ ë° Docker Hub í‘¸ì‹œ
    4.  **Deploy**: (Self-Hosted Runner ë˜ëŠ” SSH) ìš´ì˜ ì„œë²„ì—ì„œ `docker-compose pull && docker-compose up -d`
*   **Point**: "í…ŒìŠ¤íŠ¸ê°€ í†µê³¼í•˜ì§€ ì•Šìœ¼ë©´ ë°°í¬ë˜ì§€ ì•ŠëŠ”ë‹¤"ëŠ” ì•ˆì „ ì¥ì¹˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.

---

## 4. ğŸ“Š Monitoring: "ë¬¸ì œ í•´ê²°ì˜ ì‹œê°í™”"

í™”ë ¤í•œ ê·¸ë˜í”„ë³´ë‹¤ **'ë³‘ëª© ì§€ì  ë°œê²¬ ë° í•´ê²° ì¦ê±°'**ë¡œì„œ í™œìš©í•©ë‹ˆë‹¤.

### ğŸ¯ í•µì‹¬ ì§€í‘œ (Key Metrics)
1.  **HikariCP Connection Pool**: DB ì»¤ë„¥ì…˜ ê³ ê°ˆë¡œ ì¸í•œ ì§€ì—° í™•ì¸ (N+1 ë¬¸ì œë‚˜ íŠ¸ëœì­ì…˜ ë²”ìœ„ ë¬¸ì œ ë°œê²¬ ì‹œ ìœ ìš©).
2.  **CPU / Memory Usage**: ëŒ€ëŸ‰ì˜ ì¢Œì„ ìƒì„±(`Stream Consumer`) ì‹œ ë¶€í•˜ ëª¨ë‹ˆí„°ë§.
3.  **Slow Query**: ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ ëª¨ë‹ˆí„°ë§.

### ğŸ›  êµ¬ì„±
*   **Prometheus**: Spring Boot Actuator ì§€í‘œ ìˆ˜ì§‘.
*   **Grafana**: ì‹œê°í™” ëŒ€ì‹œë³´ë“œ.
*   **k6 (Load Testing)**: íŠ¸ë˜í”½ì„ ë°œìƒì‹œì¼œ ê·¸ë˜í”„ì˜ ë³€í™”(CPU ìŠ¤íŒŒì´í¬, ì»¤ë„¥ì…˜ í’€ ë¶€ì¡±)ë¥¼ ìº¡ì²˜ -> í¬íŠ¸í´ë¦¬ì˜¤ì˜ 'ë¬¸ì œ í•´ê²°' ì„¹ì…˜ ì´ë¯¸ì§€ë¡œ í™œìš©.

---

## ğŸ“… Action Plan (1 Week)

| Day | Focus | Tasks |
| :--- | :--- | :--- |
| **Day 1** | **Plan & Redis Set** | í˜„ì¬ ê³„íš í™•ì •, Redis Docker ì„¤ì¹˜ ë° Spring Boot ì—°ë™ |
| **Day 2** | **Refactor Code** | `@Async` ì œê±° -> Redis Streams (Producer/Consumer) êµ¬í˜„ |
| **Day 3** | **Dockerize** | `Dockerfile`, `docker-compose.yml` ì‘ì„± ë° ë¡œì»¬ êµ¬ë™ í…ŒìŠ¤íŠ¸ |
| **Day 4** | **CI/CD** | Github Actions ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±, ìë™ ë°°í¬ íŒŒì´í”„ë¼ì¸ êµ¬ì¶• |
| **Day 5** | **Monitoring** | Prometheus + Grafana ì—°ë™, ëŒ€ì‹œë³´ë“œ êµ¬ì„± |
| **Day 6** | **Testing** | k6 ë¶€í•˜ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰, ëª¨ë‹ˆí„°ë§ ì§€í‘œ ìº¡ì²˜ (Before/After) |
| **Day 7** | **Documentation** | README, í¬íŠ¸í´ë¦¬ì˜¤ ì—…ë°ì´íŠ¸ (ì˜ë„ì  ë°°ì œ ë…¼ë¦¬ ì„œìˆ ) |
